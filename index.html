<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
		<title></title>
		<link rel="stylesheet" href="css/index.css" />
		<script src="./js/personal.js"></script>
	</head>
	<body>
		<div class="wrap">
			<header class="header_wrap">
				<div class='header_main'>
					<h1 class="logo">
						<a href="javascript:;">音悦tai
							<img src="./img/logo.png" alt="logo">
						</a>
					</h1>
					<div class='header_right'>
						<div class="search_btn"></div>
						<div class="login">登录</div>
					</div>
				</div>
			</header>
			<!--导航-->
			<nav class="navWrap">
				<ul class="navList">
					<li class="active">
						<a href="javascript:;">首页</a>
					</li>
					<li class="">
						<a href="javascript:;">频道</a>
					</li>
					<li class="">
						<a href="javascript:;">V榜</a>
					</li>
					<li class="">
						<a href="javascript:;">商城</a>
					</li>
					<li class="">
						<a href="javascript:;">众筹</a>
					</li>
					<li class="">
						<a href="javascript:;">悦单</a>
					</li>
					<li class="">
						<a href="javascript:;">APP下载</a>
					</li>
					<li class="">
						<a href="javascript:;">饭团</a>
					</li>
					<li class="">
						<a href="javascript:;">资讯</a>
					</li>
					<li class="">
						<a href="javascript:;">我的家</a>
					</li>
					<li class="">
						<a href="javascript:;">M V</a>
					</li>
					<li class="">
						<a href="javascript:;">热门应用</a>
					</li>
				</ul>
			</nav>
			<div class="content_wrap">
				<div class='content'>
					<!--轮播图banner-->
					<div class='banner_wrap'>
						<ul class="banner_list">
							<li class="banner_item">
								<a href="javascript:;">
									<img src="./img/1.jpg" alt=""/>
								</a>
							</li>
							<li class="banner_item">
								<a href="javascript:;">
									<img src="./img/2.jpg" alt=""/>
								</a>
							</li>
							<li class="banner_item">
								<a href="javascript:;">
									<img src="./img/3.jpg" alt=""/>
								</a>
							</li>
							<li class="banner_item">
								<a href="javascript:;">
									<img src="./img/4.jpg" alt=""/>
								</a>
							</li>
							<li class="banner_item">
								<a href="javascript:;">
									<img src="./img/5.jpg" alt=""/>
								</a>
							</li>
						</ul>
						<div class='icons'>
							<span class="active"></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
						</div>
					</div>
					<!--mv区域-->
					<div class='mvBox'>
						<div class='titleBox'>
							<h3 class="boxTitle">MV首播</h3>
							<p class="change"><i></i>换一换</p>
						</div>
						<nav class="tabNav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span class="smallGreen"></span>
						</nav>
						<div class='videoWrap'>
							<div class='videoContent'>
								<ul class="loading"></ul>
								<ul class="videoList">
									<li>
										<div>
											<img src="./img/a.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/b.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/c.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/d.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/e.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/f.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
								</ul>
								<ul class="loading"></ul>
							</div>
						</div>
					</div>
					<div class='mvBox'>
						<div class='titleBox'>
							<h3 class="boxTitle">娱乐</h3>
							<p class="change"><i></i>换一换</p>
						</div>
						<nav class="tabNav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span class="smallGreen"></span>
						</nav>
						<div class='videoWrap'>
							<div class='videoContent'>
								<ul class="loading"></ul>
								<ul class="videoList">
									<li>
										<div>
											<img src="./img/a.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/b.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/c.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/d.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/e.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/f.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
								</ul>
								<ul class="loading"></ul>
							</div>
						</div>
					</div>
					<div class='mvBox'>
						<div class='titleBox'>
							<h3 class="boxTitle">热播推荐</h3>
							<p class="change"><i></i>换一换</p>
						</div>
						<nav class="tabNav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span class="smallGreen"></span>
						</nav>
						<div class='videoWrap'>
							<div class='videoContent'>
								<ul class="loading"></ul>
								<ul class="videoList">
									<li>
										<div>
											<img src="./img/a.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/b.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/c.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/d.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/e.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/f.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
								</ul>
								<ul class="loading"></ul>
							</div>
						</div>
					</div>
					<div class='mvBox'>
						<div class='titleBox'>
							<h3 class="boxTitle">音乐现场</h3>
							<p class="change"><i></i>换一换</p>
						</div>
						<nav class="tabNav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span class="smallGreen"></span>
						</nav>
						<div class='videoWrap'>
							<div class='videoContent'>
								<ul class="loading"></ul>
								<ul class="videoList">
									<li>
										<div>
											<img src="./img/a.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/b.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/c.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/d.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/e.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/f.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
								</ul>
								<ul class="loading"></ul>
							</div>
						</div>
					</div>
					<div class='mvBox'>
						<div class='titleBox'>
							<h3 class="boxTitle">猜你喜欢</h3>
							<p class="change"><i></i>换一换</p>
						</div>
						<nav class="tabNav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<span class="smallGreen"></span>
						</nav>
						<div class='videoWrap'>
							<div class='videoContent'>
								<ul class="loading"></ul>
								<ul class="videoList">
									<li>
										<div>
											<img src="./img/a.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/b.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/c.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/d.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/e.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
									<li>
										<div>
											<img src="./img/f.jpg" alt=""/>
											<a>Angel (Feat. 泰妍)</a>
											<p>chancellor &amp; 泰妍</p>
										</div>
									</li>
								</ul>
								<ul class="loading"></ul>
							</div>
						</div>
					</div>
					<div class="footer">
						Copyright &copy; 2016 yinyuetai.com
					</div>
				</div>
				<div class='scrollBar'></div>
			</div>
		</div>
	</body>
	<script>
		window.onload = function(){
			//rem适配
			!(function(){
				var width = document.documentElement.clientWidth;
				var styleNode = document.createElement('style');
				styleNode.innerHTML = 'html{font-size:'+width/16+'px !important;}';
				document.head.appendChild(styleNode);
			})();
			
			//取消默认行为
			document.addEventListener('touchstart',function(event){
                event.preventDefault();
			});
			// a标签点透事件
			var a = document.querySelectorAll('a');
			a.forEach(function(item){
				item.addEventListener('touchstart',function(){
					window.location.href = this.href;
					
				})
			});

            navMove();
            changActive();
            setBannerWidth();
            bannerMove();
            tabMove();
            mainMove();
        };
			// nav导航条移动

			function navMove(){
			    var navWrap = document.querySelector('.wrap .navWrap');
                contentMove(navWrap,'true');
			}

            //nav导航点击
            function changActive() {
				var navListItem = document.querySelectorAll('.wrap .navWrap .navList li');
                var isMove = false;
				navListItem.forEach(function (item) {
					item.addEventListener('touchmove',function () {
                        isMove = true;
                    });
                    item.addEventListener('touchend',function () {
						if (!isMove) {
                            navListItem.forEach(function (item) {
								item.classList.remove('active');
								// item.className = '';
                            });
                            this.classList.add('active');
						}
                        isMove = false;
                    });

                })
            }

            //动态设定轮播图的宽
            function setBannerWidth() {
				var bannerList = document.querySelector('.wrap .content_wrap .content .banner_wrap .banner_list');
                //无缝滑屏
				bannerList.innerHTML += bannerList.innerHTML;
				var bannerItem = document.querySelectorAll('.wrap .content_wrap .content .banner_wrap .banner_list .banner_item');
				var styleNode = document.createElement('style');
                styleNode.innerHTML = '.wrap .content_wrap .content .banner_wrap .banner_list{width:'+bannerItem.length+'00%;} .wrap .content_wrap .content .banner_wrap .banner_list .banner_item{width:'+100/bannerItem.length+'%;}';
            	// styleNode.innerHTML = '.wrap .content_wrap .content .banner_wrap .banner_list .banner_item{width:'+100/bannerItem.length+'%;}';
                document.head.appendChild(styleNode);
            }

            //轮播图
            function bannerMove() {
				var eleX = 0;
				var startX = 0;
                var startY = 0;
				var index = 0;
                var isFirst = true;
                var timer = null;
				var bannerWrap = document.querySelector('.wrap .content_wrap .content .banner_wrap');
                var bannerList = document.querySelector('.wrap .content_wrap .content .banner_wrap .banner_list');
                var bannerItem = document.querySelectorAll('.wrap .content_wrap .content .banner_wrap .banner_list .banner_item');
                var iconItem = document.querySelectorAll('.wrap .content_wrap .content .banner_wrap .icons span');

                bannerWrap.addEventListener('touchstart',function (event) {
                    var touch = event.changedTouches[0];
                    bannerList.style.transition = 'none';
                    if (index === 0) {
                        index = iconItem.length;
                        var lastX = -index*document.documentElement.clientWidth;
                        transformCss(bannerList,'translateX',lastX);
                    }else if (index === bannerItem.length-1){
                        index = iconItem.length-1;
                        var lastX = -index*document.documentElement.clientWidth;
                        transformCss(bannerList,'translateX',lastX);
					}

                    eleX = transformCss(bannerList,'translateX');
                    startX = touch.clientX;
                    startY = touch.clientY;
                    isFirst = true;
                    clearInterval(timer);
                });
                bannerWrap.addEventListener('touchmove',function (event) {

                    var touch = event.changedTouches[0];
                    //非第一次滑屏的防抖逻辑
                    if(!isFirst){
                        return;
                    }
					var endX = touch.clientX;
                    var endY = touch.clientY;
					var disX = endX - startX;
                    var disY = endY - startY;


                    //只是在考虑滑屏时候第一次滑动的逻辑，看垂直方向是不是大于水平方向的距离差
                    if(Math.abs(disY) > Math.abs(disX)){

						isFirst = false;//给后面滑屏的非第一次置一个标志；
						return;//只是禁止第一次水平方向的逻辑

                    }


					var lastX = disX + eleX;

					transformCss(bannerList,'translateX',lastX);
                });
                bannerWrap.addEventListener('touchend',function () {
                    var lastX = transformCss(bannerList,'translateX');
                    //四舍五入过半滑入下一张
                    index = Math.round(-lastX/document.documentElement.clientWidth);
                    lastX = -index*document.documentElement.clientWidth;
                    //过渡动画
                    bannerList.style.transition = '1s';
                    transformCss(bannerList,'translateX',lastX);

                    //小圆点先清除再添加
                    iconItem.forEach(function (item) {
						item.classList.remove('active');
                    });
                    iconItem[index%iconItem.length].classList.add('active');
                    autoBanner();
                });
                //自动轮播
                autoBanner();
                function autoBanner() {
                    timer = setInterval(function () {
                        if (index === bannerItem.length-1) {
                            index = iconItem.length-1;
                            var lastX = -index*document.documentElement.clientWidth;
                            bannerList.style.transition = 'none';
                            transformCss(bannerList,'translateX',lastX);
						}
						setTimeout(function () {
                            index++;
                            var lastX = -index*document.documentElement.clientWidth;
                            bannerList.style.transition = '1s';
                            transformCss(bannerList,'translateX',lastX);

                            //小圆点先清除再添加
                            iconItem.forEach(function (item) {
                                item.classList.remove('active');
                            });
                            iconItem[index%iconItem.length].classList.add('active');
                        },20)

                        },2000)
                }
            }
            //tab滑屏逻辑
			function tabMove() {
				var videoWarp = document.querySelectorAll('.wrap .content_wrap .content .mvBox .videoWrap');
                var videoContent = document.querySelectorAll('.wrap .content_wrap .content .mvBox .videoWrap .videoContent');
				var tabNav = document.querySelectorAll('.wrap .content_wrap .content .mvBox .tabNav');
				var width = tabNav[0].offsetWidth;

                for (var i = 0; i < videoWarp.length; i++) {
                    move(videoWarp[i],videoContent[i],tabNav[i]);
				}
				//事件绑定监听
                function move(videoWarp, videoContent, tabNav) {
					transformCss(videoContent,'translateX',-width);
					var eleStart = 0;
					var mouseStartX = 0;
                    var mouseStartY = 0;
                    var disX = 0;
                    var isFirst = true;
                    videoWarp.addEventListener('touchstart',function (event) {
						var touch = event.changedTouches[0];
                        eleStart = transformCss(videoContent,'translateX');
                        mouseStartX = touch.clientX;
                        mouseStartY = touch.clientY;
                        isFirst = true;
                        if(Math.abs(disX) < width/2){
                            videoContent.style.transition = 'none';
                        }
                    });
                    videoWarp.addEventListener('touchmove',function (event) {
                        var touch = event.changedTouches[0];
                        //防抖
                        if (!isFirst) {
                            return;
						}
                        var mouseEndX = touch.clientX;
                        var mouseEndY = touch.clientY;
						disX = mouseEndX - mouseStartX;
                        var disY = mouseEndY - mouseStartY;

                        //第一次运行判断
                        if (Math.abs(disY) > Math.abs(disX)) {
                            isFirst = false;
                            return;
						}
                        var lastX = disX + eleStart;
                        transformCss(videoContent,'translateX',lastX);
                        if (Math.abs(disX) > width / 2) {
                            if (disX > 0) {
                                lastX = 0;
							}else {
                                lastX = -2 * width;
							}
                            videoContent.style.transition = '1s';
                            transformCss(videoContent,'translateX',lastX);
						}


                    });
                    videoWarp.addEventListener('touchend',function () {
                        if(Math.abs(disX) < width/2){
                            var lastX = -width;
                            videoContent.style.transition = '1s';
                            transformCss(videoContent,'translateX',lastX);
                        }
                    });
                }
            }
            //整体内容区域竖向滑屏
			function mainMove() {
                var contentWrap = document.querySelector('.wrap .content_wrap');
                var content = document.querySelector('.wrap .content_wrap .content');

				var scrollBar = document.querySelector('.wrap .content_wrap .scrollBar');

			    //布局bug deal，只针对这个项目
			    var heightLength = 0;
			    allSibling(contentWrap).forEach(function (item) {
					heightLength += item.offsetHeight
                });
				var contentView = document.documentElement.clientHeight - heightLength;
				var scale = contentView / content.offsetHeight;
				//
                scrollBar.style.height = scale * contentView + 'px'

                var callback = {
                    start:function(){
                        scrollBar.style.opacity = 1;
                    },

                    move:function(){
                        scrollBar.style.opacity = 1;
                        //跟随内容的移动往相反的方向移动
                        var lastY = transformCss(content,'translateY');
                        transformCss(scrollBar,'translateY',-scale * lastY);
                    },

                    end:function(){
                        scrollBar.style.opacity = 0;
                    }
                }
                contentMove(contentWrap,'false',callback)
			}

	</script>
</html>
